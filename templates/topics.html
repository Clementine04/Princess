{% extends "base.html" %}
{% block title %}{{ subject.name }} - Topics - Princess's Website{% endblock %}
{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/topics.css') }}">
{% endblock %}
{% block content %}
  <div class="welcome-section">
    <h1>{{ subject.name }} - Topics</h1>
    <p class="tagline">Manage topics and flashcards for this subject</p>
  </div>

  <div class="topics-container">
    <div class="card add-topic-card">
      <h3><i class="fas fa-plus-circle"></i> Add New Topic</h3>
      <form action="{{ url_for('add_topic', subject_id=subject.id) }}" method="POST" class="add-topic-form">
        <div class="form-group">
          <label for="topicName">Topic Name</label>
          <input type="text" name="topicName" id="topicName" placeholder="Enter topic name" required>
        </div>
        <button type="submit" class="btn add-btn">
          <i class="fas fa-plus"></i> Add Topic
        </button>
      </form>
    </div>

    <h2 class="section-title"><i class="fas fa-list"></i> Topics in {{ subject.name }}</h2>
    
    {% if topics %}
      <div class="topics-grid">
        {% for topic in topics %}
          <div class="topic-card">
            <div class="topic-header">
              <h3>{{ topic.name }}</h3>
              <span class="flashcard-count">{{ topic.flashcards|length }} Flashcards</span>
            </div>
            <div class="topic-actions">
              <a href="{{ url_for('flashcard', topic_id=topic.id) }}" class="btn create-btn">
                <i class="fas fa-plus"></i> Create Flashcards
              </a>
              {% if topic.flashcards %}
              <a href="{{ url_for('view_flashcards', topic_id=topic.id) }}" class="btn view-btn">
                <i class="fas fa-eye"></i> View Flashcards
              </a>
              {% endif %}
              <form action="{{ url_for('delete_topic', topic_id=topic.id) }}" method="POST" class="delete-form" onsubmit="return confirm('Are you sure you want to delete this topic? All flashcards will be deleted.')">
                <button type="submit" class="btn delete-btn">
                  <i class="fas fa-trash-alt"></i> Delete
                </button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">
        <div class="empty-icon">
          <i class="fas fa-file-alt"></i>
        </div>
        <p>No topics found for this subject. Create one to get started!</p>
      </div>
    {% endif %}
  </div>

  <div class="quiz-section">
    <h2 class="section-title"><i class="fas fa-question-circle"></i> Create Quiz for {{ subject.name }}</h2>
    <div class="card quiz-card">
      <a href="{{ url_for('quiz_options', subject_id=subject.id) }}" class="btn quiz-btn">
        <i class="fas fa-magic"></i> Create New Quiz
      </a>
      {% if quiz_results %}
        <div class="quiz-results">
          <h4>Recent Quiz Results</h4>
          <table class="results-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Topic</th>
                <th>Type</th>
                <th>Difficulty</th>
                <th>Score</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for result in quiz_results %}
                <tr>
                  <td>{{ result.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                  <td>{{ result.topic.name if result.topic else 'N/A' }}</td>
                  <td>{{ result.question_type }}</td>
                  <td>{{ result.difficulty }}</td>
                  <td>{{ result.score }}/{{ result.total_questions }}</td>
                  <td>
                    <form action="{{ url_for('delete_quiz_result', result_id=result.id) }}" method="POST" class="delete-form" onsubmit="return confirm('Are you sure you want to delete this quiz result?')">
                      <button type="submit" class="btn delete-result-btn" title="Delete">
                        <i class="fas fa-trash-alt"></i>
                      </button>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="no-results">No quiz results yet for this subject.</p>
      {% endif %}
    </div>
  </div>

  <div class="button-row">
    <a href="{{ url_for('subjects') }}" class="btn back-btn">
      <i class="fas fa-arrow-left"></i> Back to Subjects
    </a>
  </div>

  <script>
    // Form animation
    document.addEventListener('DOMContentLoaded', function() {
      const formElements = document.querySelectorAll('.form-group');
      formElements.forEach((element, index) => {
        setTimeout(() => {
          element.classList.add('animated');
        }, 100 * index);
      });
      
      // Add animation to topic cards
      const topicCards = document.querySelectorAll('.topic-card');
      topicCards.forEach((card, index) => {
        setTimeout(() => {
          card.classList.add('animated');
        }, 100 * index);
      });
    });
  </script>
{% endblock %} 